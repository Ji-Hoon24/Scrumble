<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.scrumble.post.mapper.PostMapper">

    <select id="selectPost" parameterType="Long" resultType="postDto">
        /* kr.co.scrumble.mapper.PostMapper.selectPost */
        SELECT  POST_ID
        ,       TITLE
        ,       USER_NO
        ,       POST_DT
        ,       REG_ID
        ,       REG_DT
        ,       UDT_ID
        ,       UDT_DT
        FROM POST
        WHERE POST_ID = #{id}
    </select>

    <insert id="insertPost" parameterType="postDto" useGeneratedKeys="true" keyProperty="postId">
        /* kr.co.scrumble.mapper.PostMapper.insertPost */
        INSERT INTO POST (
                TITLE
            ,   USER_NO
            ,   POST_DT
            ,   REG_ID
            ,   REG_DT
            ,   UDT_ID
            ,   UDT_DT
        ) VALUES (
                #{title}
            ,   #{userNo}
            ,   #{postDt}
            ,   #{regId}
            ,   NOW()
            ,   #{udtId}
            ,   NOW()
        )
    </insert>

    <update id="updatePost" parameterType="postDto">
        /* kr.co.scrumble.mapper.PostMapper.updatePost */
        UPDATE POST SET
            TITLE = #{title}
        ,   POST_DT = #{postDt}
        ,   UDT_ID = #{udtId}
        ,   UDT_DT = NOW()
        WHERE POST_ID = #{id}
    </update>

    <delete id="deletePost" parameterType="Long">
        /* kr.co.scrumble.mapper.PostMapper.updatePost */
        DELETE FROM POST WHERE POST_ID = #{id}
    </delete>

    <select id="selectPostDetail" parameterType="Long" resultType="postDetailDto">
        /* kr.co.scrumble.mapper.PostMapper.selectPostDetail */
        SELECT  DETAIL_ID
        ,       POST_ID
        ,       CONTENTS
        ,       COMPLETE_YN
        ,       POST_CD
        ,       REG_ID
        ,       REG_DT
        ,       UDT_ID
        ,       UDT_DT
        FROM POST_DETAIL
        WHERE DETAIL_ID = #{detailId}
    </select>

    <insert id="insertPostDetail" parameterType="postDto">
        /* kr.co.scrumble.mapper.PostMapper.insertPostDetail */
        INSERT INTO POST_DETAIL (
                DETAIL_ID
            ,   POST_ID
            ,   CONTENTS
            ,   COMPLETE_YN
            ,   POST_CD
            ,   REG_ID
            ,   REG_DT
            ,   UDT_ID
            ,   UDT_DT
        )
        SELECT  IFNULL(MAX(DETAIL_ID) + 1, 1)
        ,       #{postId}
        ,       #{contents}
        ,       #{completeYn}
        ,       #{postCd}
        ,       #{regId}
        ,       NOW()
        ,       #{udtId}
        ,       NOW()
        FROM POST_DETAIL
        WHERE POST_ID = #{postId}
    </insert>

    <update id="updatePostDetail" parameterType="postDto">
        /* kr.co.scrumble.mapper.PostMapper.updatePostDetail */
        UPDATE POST_DETAIL SET
            CONTENTS = #{contents}
        ,   COMPLETE_YN = #{completeYn}
        ,   POST_CD =#{postCd}
        ,   UDT_ID = #{udtId}
        ,   UDT_DT = NOW()
        WHERE   DETAIL_ID = #{detailId}
        AND     POST_ID =#{postId}
    </update>

    <delete id="deletePostDetail" parameterType="Long">
        /* kr.co.scrumble.mapper.PostMapper.deletePostDetail */
        DELETE FROM POST_DETAIL
        WHERE DETAIL_ID = #{detailId}
        AND   POST_ID = #{postId}
    </delete>

    <select id="selectPostPage" parameterType="kr.co.scrumble.dto.request.PostRequestDto" resultType="postDto">
        /* kr.co.scrumble.mapper.PostMapper.selectPostDetailList */
        SELECT  POST_ID
        ,       TITLE
        ,       USER_NO
        ,       POST_DT
        ,       REG_ID
        ,       REG_DT
        ,       UDT_ID
        ,       UDT_DT
        FROM POST
        ORDER BY REG_DT DESC
        LIMIT 10 OFFSET (10 - (#{page} * 10))
    </select>

    <select id="selectPostDetailList" parameterType="postDto" resultType="postDetailDto">
        /* kr.co.scrumble.mapper.PostMapper.selectPostDetailList */
        SELECT  DETAIL_ID
        ,       POST_ID
        ,       CONTENTS
        ,       COMPLETE_YN
        ,       POST_CD
        ,       REG_ID
        ,       REG_DT
        ,       UDT_ID
        ,       UDT_DT
        FROM POST_DETAIL
        WHERE POST_ID = #{postId}
    </select>
</mapper>
